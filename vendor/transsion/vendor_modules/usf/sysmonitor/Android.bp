// ---------------------------------------------------------------------------
// Soong config: platform selection
// ---------------------------------------------------------------------------
soong_config_module_type {
    name: "sysmonitor_cc_defaults",
    module_type: "cc_defaults",
    config_namespace: "transsion_sysmonitor",
    variables: ["platform"],
    properties: ["cflags"],
}

soong_config_string_variable {
    name: "platform",
    values: ["qcom", "mtk", "unisoc"],
}

sysmonitor_cc_defaults {
    name: "sysmonitor_platform_defaults",
    soong_config_variables: {
        platform: {
            qcom:   { cflags: ["-DSMON_PLATFORM_QCOM"]   },
            mtk:    { cflags: ["-DSMON_PLATFORM_MTK"]    },
            unisoc: { cflags: ["-DSMON_PLATFORM_UNISOC"] },
        },
    },
}

// ---------------------------------------------------------------------------
// Common C++ defaults
// ---------------------------------------------------------------------------
cc_defaults {
    name: "sysmonitor_cc_base",
    defaults: ["sysmonitor_platform_defaults"],

    cflags: [
        "-Wall",
        "-Wextra",
        "-Werror",
        "-O2",
        "-fno-exceptions",
        "-fno-rtti",
        // Uncomment for production (strips all log strings):
        // "-DSMON_LOG_DISABLED",
    ],

    target: {
        android: { cflags: ["-DANDROID"] },
    },
}


// ---------------------------------------------------------------------------
// Unit tests
// ---------------------------------------------------------------------------
cc_test {
    name: "sysmonitor_tests",
    defaults: ["sysmonitor_cc_base"],
    vendor: true,
    test_suites: ["device-tests"],

    srcs: [
        "tests/MetricStoreTest.cpp",
        "tests/CpuCollectorTest.cpp",
        "tests/NodeProbeTest.cpp",
    ],

    local_include_dirs: [
        "vendor/core/include",
        "vendor/platform/include",
    ],

    shared_libs: [
        "libsysmonitor",
        "liblog",
        "libbase",
    ],

    static_libs: [
        "libgtest",
        "libgmock",
    ],
}


// ==================== System 分区模块聚合 ====================

phony {
    name: "sysmonitor_system",
    required: [
        // Java 实现层
        "sysmonitor-java",
        // JNI 层
        "libsysmonitor_jni",

        // AIDL 接口
        "vendor.transsion.hardware.sysmonitor-V1-ndk",
        "vendor.transsion.hardware.sysmonitor-V1-java",
    ],
}

// ==================== Vendor 分区模块聚合 ====================

phony {
    name: "sysmonitor_vendor",
    required: [
        // Vendor Service
        "libsysmonitor",
        "vendor.transsion.sysmonitor-service",
        // AIDL 接口
        "vendor.transsion.hardware.sysmonitor-V1-ndk",
    ],
}
